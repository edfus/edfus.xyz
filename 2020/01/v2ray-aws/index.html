<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><title>用aws来玩玩V2ray | EDFUS&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="icon" href="/favicon.png"><link rel="preconnect" href="//cdn.jsdelivr.net" crossorigin="anonymous"><meta name="theme-color" content="#222"><meta name="subject" content="EDFUS's Personal Blog"><meta http-equiv="content-language" content="zh-CN,en-us"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 4.2.0"></head><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap"><a href="/" id="logo" style="cursor:default">EDFUS&#39;s Blog</a></h1></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/">Home | 思</a> <a class="main-nav-link" href="/categories/tech">Tech | 物</a> <a class="main-nav-link" href="/about">About | 我</a> <a class="main-nav-link" href="/more">MORE | 实验&amp;阅读</a></nav><nav id="sub-nav"><a id="nav-search-btn" class="nav-icon" title="搜索"></a></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="edfus.xyz"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-v2ray（aws）" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><ul class="article-header-tag-list" itemprop="keywords"><li class="article-header-tag-list-item"><a class="article-header-tag-list-link" href="/categories/tech/VPN/" rel="tag">VPN</a></li><li class="article-header-tag-list-item"><a class="article-header-tag-list-link" href="/categories/tech/aws/" rel="tag">aws</a></li><li class="article-header-tag-list-item"><a class="article-header-tag-list-link" href="/categories/tech/总结/" rel="tag">总结</a></li></ul><time datetime="2020-01-09T16:00:00.000Z" itemprop="datePublished" class="article-date">2020-01-10</time><div class="article-category"><a class="article-category-link" href="/categories/tech/">tech</a></div><div class="post-date">updateDate:&nbsp;&nbsp;2020-01-24</div></div><div class="article-inner toc-on"><header class="article-header"><h1 class="article-title" itemprop="name">用aws来玩玩V2ray</h1></header><div class="article-entry" itemprop="articleBody"><div id="toc"><div id="heading-index">目录</div><ol class="md-toc"><li class="md-toc-item md-toc-level-2"><a class="md-toc-link" href="#代理服务器原理及注意"><span class="md-toc-text">代理服务器原理及注意</span></a><ol class="md-toc-child"><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#另：解决1080端口被占用"><span class="md-toc-text">另：解决1080端口被占用</span></a></li></ol></li><li class="md-toc-item md-toc-level-2"><a class="md-toc-link" href="#利用AWS的免费账户"><span class="md-toc-text">利用AWS的免费账户</span></a></li><li class="md-toc-item md-toc-level-2"><a class="md-toc-link" href="#用student-developer-pack"><span class="md-toc-text">用student developer pack</span></a><ol class="md-toc-child"><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#用学生包可以嫖到什么？"><span class="md-toc-text">用学生包可以嫖到什么？</span></a></li><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#AWS学生包（不需要国际信用卡！）"><span class="md-toc-text">AWS学生包（不需要国际信用卡！）</span></a></li><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#申请免费域名"><span class="md-toc-text">申请免费域名</span></a></li></ol></li><li class="md-toc-item md-toc-level-2"><a class="md-toc-link" href="#VPS配置"><span class="md-toc-text">VPS配置</span></a><ol class="md-toc-child"><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#Ubuntu基础"><span class="md-toc-text">Ubuntu基础</span></a><ol class="md-toc-child"><li class="md-toc-item md-toc-level-4"><a class="md-toc-link" href="#用ssh连接到Ubuntu"><span class="md-toc-text">用ssh连接到Ubuntu</span></a></li><li class="md-toc-item md-toc-level-4"><a class="md-toc-link" href="#Ubuntu系统服务器获取root权限"><span class="md-toc-text">Ubuntu系统服务器获取root权限</span></a></li><li class="md-toc-item md-toc-level-4"><a class="md-toc-link" href="#更改Ubuntu服务器时间"><span class="md-toc-text">更改Ubuntu服务器时间</span></a></li><li class="md-toc-item md-toc-level-4"><a class="md-toc-link" href="#ubuntu-vi编辑器"><span class="md-toc-text">ubuntu vi编辑器</span></a></li><li class="md-toc-item md-toc-level-4"><a class="md-toc-link" href="#ubuntu-删除-span-class-chineselangpause-、-span-新建……"><span class="md-toc-text">ubuntu 删除、新建……</span></a></li></ol></li><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#v2ray及caddy安装"><span class="md-toc-text">v2ray及caddy安装</span></a></li><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#新建-span-class-chineselangpause-、-span-修改V2ray-Caddy的配置文件"><span class="md-toc-text">新建、修改V2ray | Caddy的配置文件</span></a></li><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#设置V2ray-config-json"><span class="md-toc-text">设置V2ray&#x2F;config.json</span></a></li><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#v2ray-config-json-span-class-chineselangpause-、-span-caddyfile配置文件检测"><span class="md-toc-text">v2ray&#x2F;config.json、caddyfile配置文件检测</span></a></li></ol></li><li class="md-toc-item md-toc-level-2"><a class="md-toc-link" href="#客户端V2ray的配置"><span class="md-toc-text">客户端V2ray的配置</span></a></li><li class="md-toc-item md-toc-level-2"><a class="md-toc-link" href="#VPS系统的其他设定"><span class="md-toc-text">VPS系统的其他设定</span></a><ol class="md-toc-child"><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#开启BBR"><span class="md-toc-text">开启BBR</span></a><ol class="md-toc-child"><li class="md-toc-item md-toc-level-4"><a class="md-toc-link" href="#检查Linux内核的版本"><span class="md-toc-text">检查Linux内核的版本</span></a></li></ol></li><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#VPS上的Ubuntu系统重启（System-Restart-Required）"><span class="md-toc-text">VPS上的Ubuntu系统重启（System Restart Required）</span></a></li><li class="md-toc-item md-toc-level-3"><a class="md-toc-link" href="#开机自动执行"><span class="md-toc-text">开机自动执行</span></a></li></ol></li></ol></div><hr><hr><p>一直想搞清楚VPN<span class="chineselangpause">、</span>VPS<span class="chineselangcomma">，</span>并希望在特殊时期自己也能有一个稳定的渠道……于是那几天折腾了下这方面<span class="chineselangstop">。</span></p><p>嘛<span class="chineselangcomma">，</span>但这之后就没怎么用过了<span class="chineselangstop">。</span>还是太麻烦<span class="chineselangstop">。</span></p><hr><h2 id="代理服务器原理及注意">代理服务器原理及注意</h2><ol><li><p>GFW实现网络封锁<span class="chineselangcomma">，</span>也就是“墙”的方法主要是<strong>DNS劫持和锁IP</strong>等</p></li><li><p>shadowssocks同样也是一种代理协议<span class="chineselangcomma">，</span>是其作者Clowwindy为国人设计的用于科学上网的代理协议<span class="chineselangstop">。</span>本质上ss很简单<span class="chineselangcomma">，</span>就是做了流量的转发<span class="chineselangcomma">，</span>只不过为了避免流量被检测<span class="chineselangcomma">，</span>加密并且还有<strong>混淆</strong>的功能<span class="chineselangstop">。</span></p></li><li><p><strong>正向代理</strong><span class="chineselangcomma">，</span>是从客户/客户端角度出发<span class="chineselangcomma">，</span>即为了从原始服务器中取得内容<span class="chineselangcomma">，</span>由客户端想代理服务器发出请求<span class="chineselangcomma">，</span>并指定目标访问服务器<span class="chineselangcomma">，</span>而后<span class="chineselangcomma">，</span>代理（服务器）向目标服务器转角需求<span class="chineselangcomma">，</span>并将获得的内容返回给客户端<span class="chineselangstop">。</span>正向代理闭环完成<span class="chineselangstop">。</span></p><p>在正向代理过程中隐藏了真是请求的客户端<span class="chineselangcomma">，</span>即服务端不知道正式请求客户是谁<span class="chineselangstop">。</span>讲到这里<span class="chineselangcomma">，</span>大家是不是想到了什么呢？没错<span class="chineselangcomma">，</span>大多数科学上网行为都是这么发生的<span class="chineselangstop">。</span></p></li><li><p><strong>反向代理</strong>一般是从服务端出发<span class="chineselangcomma">，</span>从网络或者客户（端）发向反向代理出请求<span class="chineselangcomma">，</span>反向代理服务器收到需求后判断请求走向何处<span class="chineselangcomma">，</span>然后再将结果反馈给客户端<span class="chineselangstop">。</span>反向代理闭环完成<span class="chineselangstop">。</span></p><p>同样需要注意的是<span class="chineselangcomma">，</span>在反向代理过程中<span class="chineselangcomma">，</span>隐藏了内部服务器的信息<span class="chineselangcomma">，</span>用户不需要知道是具体哪一台服务器提供的服务<span class="chineselangcomma">，</span>只要知道反向代理服务器是谁就好了<span class="chineselangcomma">，</span>我们甚至可以把反向代理服务器当做真正服务器看待<span class="chineselangstop">。</span>这种形式的代理通常被用作实现负载均衡<span class="chineselangcomma">，</span>比如Nginx就是一种出色的反向代理服务器<span class="chineselangstop">。</span></p></li><li><p><strong>我个人在科学上网-自建这方面需要的是个人的（对带宽|延迟无太大要求）<span class="chineselangpause">、</span>安全的<span class="chineselangpause">、</span>稳定甚至可以撑过特殊时期的VPN体验<span class="chineselangcomma">，</span>日常并不使用V2ray</strong>（另外也是实验性质的）<span class="chineselangcomma">，</span>所以使用白嫖的VPS<span class="chineselangcomma">，</span>用目前最安全的v2ray+caddy+websocket+tls（通过path）<span class="chineselangstop">。</span>域名是免费的freenom的tk域名</p><blockquote><p>Let’s Encrypt提供了3类验证（Challenge）方式<span class="chineselangcomma">，</span>用于颁发证书(<strong>这里使用来caddy完成</strong>)：</p><ul><li><code>HTTP-01</code>：通过HTTP访问服务器80端口的<code>.well-known/acme-challenge</code>验证<span class="chineselangstop">。</span></li><li><code>DNS-01</code>：在DNS中添加<code>_acme-challenge</code>开头的TXT记录<span class="chineselangcomma">，</span>这种方式因为能签发通配符证书（Wildcard）而被大范围使用<span class="chineselangstop">。</span></li><li><code>TLS-SNI-01</code><span class="chineselangpause">、</span><code>TLS-ALPN-01</code>：通过TLS的方式对443端口访问进行验证<span class="chineselangstop">。</span></li></ul></blockquote></li></ol><h3 id="另：解决1080端口被占用">另：解决1080端口被占用</h3><p>http 的默认端口是 80；https 的默认端口是 433</p><p>ssh 的默认端口是 22；telnet 的默认端口是 23；ftp 的默认端口是 20 和 21<span class="chineselangcomma">，</span>其中 20 负责连接<span class="chineselangcomma">，</span>21 负责传输数据<span class="chineselangstop">。</span></p><p>1080端口是Socks代理服务使用的端口<span class="chineselangstop">。</span></p><p><a href="https://blog.csdn.net/Hydra_xyc/article/details/91049952" target="_blank" rel="noopener">SSR的1080端口被占用</a></p><blockquote><p>配置文件 gui-config.json中</p><p>找到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;localPort&quot; : 1080,</span><br></pre></td></tr></table></figure><p>你完全可以换一个端口号<span class="chineselangcomma">，</span>比如</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;localPort&quot; : 12345 #随便一个不会被占用的</span><br></pre></td></tr></table></figure><p>再在设置里改下本地端口就行</p><p>（Global setting - Local proxy - Proxy port)</p></blockquote><p>所以说在客户端设置代理端口的时候不妨找个偏僻的不用的</p><h2 id="利用AWS的免费账户">利用AWS的免费账户</h2><blockquote><p><a href="https://www.cloudping.info/" target="_blank" rel="noopener">https://www.cloudping.info/</a></p><p>检测AWS的机房到你这的延迟</p></blockquote><blockquote><blockquote><p><a href="https://www.dazhuanlan.com/2020/01/02/5e0dd17aaef45/" target="_blank" rel="noopener">https://www.dazhuanlan.com/2020/01/02/5e0dd17aaef45/</a></p><ul><li>全球付的开通</li><li>注册亚马逊云账户</li><li>创建实例</li><li>ping<span class="chineselangpause">、</span>删除重建实例</li><li>连接实例</li></ul><p>注：全球付等是非白嫖用户的做法<span class="chineselangcomma">，</span>我这里使用学生包<span class="chineselangstop">。</span></p></blockquote><p><strong>注意事项：</strong></p><ol><li><p><strong>AWS的官方操作指南很详细</strong></p></li><li><blockquote><p>AWS 免费套餐包括为期一年每月 750 小时 Linux 和 Windows 微型实例的试用时间<span class="chineselangstop">。</span></p></blockquote></li></ol><p>注意<span class="chineselangcomma">，</span>是“和”<span class="chineselangcomma">，</span>也就是说你可以同时运行一个 Linux 微型实例和一个 Windows 微型实例<span class="chineselangcomma">，</span>各免费750小时<span class="chineselangstop">。</span>而且一个月最多也就24×31=744h<span class="chineselangcomma">，</span>时间是肯定不用担心了<span class="chineselangstop">。</span>但是别高兴得太早<span class="chineselangstop">。</span>要用免费的你必须用微型实例<span class="chineselangcomma">，</span>而微型实例只能使用以 EBS 作为存储的系统镜像；再看一下 EBS 的免费额度<span class="chineselangcomma">，</span>区区30GB<span class="chineselangdash">——</span>鉴于所有 Windows 镜像要求最小存储容量为30GB<span class="chineselangcomma">，</span>要同时再运行一个 Linux 实例就得为 EBS 埋单了<span class="chineselangstop">。</span>所以归根到底<span class="chineselangcomma">，</span>Amazon只允许你同时运行一个微型实例<span class="chineselangstop">。</span>如果你想先用一会 Linux<span class="chineselangcomma">，</span>再换 Windows 玩玩<span class="chineselangcomma">，</span>这样也是可以的<span class="chineselangcomma">，</span>只要保证运行新的实例之前已经彻底关闭(Terminate)旧的实例<span class="chineselangstop">。</span>另外EC2 只是 AWS 免费套餐的（三十六分之）一部分<span class="chineselangcomma">，</span>其他免费资源用起来啊！</p><ol start="3"><li><p>扣费1：我第一次接到警报邮件是我的卷存储超出了免费套餐的85%<span class="chineselangstop">。</span>后面发现是因为我之前创建了一个EC2实例<span class="chineselangcomma">，</span>给这个实例增加了一个卷<span class="chineselangcomma">，</span>用完之后我就把这个实例stop了<span class="chineselangstop">。</span>我以为stop掉就不会扣费了<span class="chineselangcomma">，</span>但是发现<span class="chineselangcomma">，</span>即使你把EC2实例stop了<span class="chineselangcomma">，</span>但是你这个实例用的那个卷还是在使用状态<span class="chineselangcomma">，</span>所以导致超额<span class="chineselangstop">。</span>后来我把那个EC2实例终止掉<span class="chineselangcomma">，</span>终止的时候把这个卷也释放掉就好了<span class="chineselangstop">。</span></p></li><li><blockquote><p>EC2特点之一是允许用户随时更新实例状态<span class="chineselangcomma">，</span>用户可以随时加入或删除实例<span class="chineselangcomma">，</span>实例状态的动态变化方便了用户<span class="chineselangcomma">，</span>但是却给防火墙的配置带来了麻烦<span class="chineselangstop">。</span></p></blockquote></li></ol><p>因此<strong>EC2里的VPS是没有防火墙(firewalld)的<span class="chineselangcomma">，</span>流量管理通过安全组的出站入站规则完成</strong><br>（当然你吃饱了也可以自己装个防火墙(<code>ubuntu</code>)）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install firewalld</span><br><span class="line">sudo systemctl start firewalld</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> firewalld</span><br><span class="line">sudo systemctl status firealld</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove --auto-remove firewalld <span class="comment">#卸载</span></span><br></pre></td></tr></table></figure><ol start="5"><li><blockquote><p>这里是官网的介绍:</p></blockquote></li></ol><blockquote><p><strong>无法对实例执行ping操作</strong><br>说得很详细<span class="chineselangcomma">，</span>简单来说就是如果你想ping通EC2实例的话需要单独设置入站规则<span class="chineselangstop">。</span><br>怎么设置呢?<br>在EC2 Dashboard选择安全组选项卡<span class="chineselangcomma">，</span>选中要修改的安全组选择入站规则(Inbound)-编辑-添加规则<br>类型选择自定义ICMP规则<span class="chineselangcomma">，</span><br>选择请求(Echo Request)<span class="chineselangcomma">，</span><br>来源选择任何位置<span class="chineselangstop">。</span><br>然后点击保存<span class="chineselangcomma">，</span>就可以Ping就能ping通了<br><span class="chineselangdash">——</span><span class="chineselangdash">——</span><span class="chineselangdash">——</span><span class="chineselangdash">——</span><span class="chineselangdash">——</span><span class="chineselangdash">——</span><span class="chineselangdash">——</span><span class="chineselangdash">——</span><br>原文链接：<a href="https://blog.csdn.net/daerzei/article/details/81169349" target="_blank" rel="noopener">https://blog.csdn.net/daerzei/article/details/81169349</a></p></blockquote><ol start="6"><li>安全组：<br>在 <strong>Inbound</strong> 选项卡上<span class="chineselangcomma">，</span>创建以下规则 (为每个新规则选择 <strong>Add Rule</strong>)<span class="chineselangcomma">，</span>然后选择 <strong>Create</strong>：</li></ol><ul><li><p>从 <strong>Type</strong> 列表中选择 <strong>HTTP</strong><span class="chineselangcomma">，</span>确保 <strong>Source</strong> 设置为 <strong>Anywhere</strong> (<code>0.0.0.0/0</code>)<span class="chineselangstop">。</span></p></li><li><p>从 <strong>Type</strong> 列表中选择 <strong>HTTPS</strong><span class="chineselangcomma">，</span>确保 <strong>Source</strong> 设置为 <strong>Anywhere</strong> (<code>0.0.0.0/0</code>)<span class="chineselangstop">。</span></p></li><li><p>从 <strong>Type</strong> 列表中选择 <strong>SSH</strong><span class="chineselangstop">。</span>在<strong>源</strong>框中<span class="chineselangcomma">，</span>选择 <strong>My IP</strong> 以便使用本地计算机的公有 IPv4 地址自动填充该字段<span class="chineselangstop">。</span>或者<span class="chineselangcomma">，</span>选择<strong>自定义</strong>并用 CIDR 表示法指定计算机的公有 IPv4 地址或网络<span class="chineselangstop">。</span>要采用 CIDR 表示法指定单个 IP 地址<span class="chineselangcomma">，</span>请添加路由前缀 <code>/32</code><span class="chineselangcomma">，</span>例如 <code>203.0.113.25/32</code><span class="chineselangstop">。</span>如果您的公司要分配同一范围内的地址<span class="chineselangcomma">，</span>请指定整个范围<span class="chineselangcomma">，</span>例如 <code>203.0.113.0/24</code><span class="chineselangstop">。</span></p></li><li><p><strong>警告</strong></p><p>出于安全原因<span class="chineselangcomma">，</span>我们不建议您允许从所有 IPv4 地址 (<code>0.0.0.0/0</code>) 对您的实例进行 SSH 访问（以测试为目的的短暂访问除外）<span class="chineselangstop">。</span></p></li></ul><ol start="7"><li>弹性 IP 地址 是专为动态云计算设计的静态 IPv4 地址<span class="chineselangstop">。</span>弹性 IP 地址与您的 AWS 账户关联<span class="chineselangstop">。</span>借助弹性 IP 地址<span class="chineselangcomma">，</span>您可以快速将地址重新映射到您的账户中的另一个实例<span class="chineselangcomma">，</span>从而屏蔽实例故障<span class="chineselangstop">。</span></li></ol><p>弹性 IP 地址是公有 IPv4 地址<span class="chineselangcomma">，</span>可通过 Internet 访问<span class="chineselangstop">。</span>如果您的实例没有公有 IPv4 地址<span class="chineselangcomma">，</span>则可以将弹性 IP 地址与您的实例关联以启用与 Internet 的通信；例如<span class="chineselangcomma">，</span>从本地计算机连接到您的实例<span class="chineselangstop">。</span></p></blockquote><h2 id="用student-developer-pack">用student developer pack</h2><h3 id="用学生包可以嫖到什么？">用学生包可以嫖到什么？</h3><p>office education</p><p>azure 一年 30 刀（国内）</p><p>Jetbrains 全家桶<span class="chineselangcomma">，</span>Mosek</p><blockquote><p>微软的 Dream Spark 也提供了 Github 学生礼包<span class="chineselangcomma">，</span>但是相比于 Github 那么严格<span class="chineselangcomma">，</span>财大气粗的微软显然有钱任性很多<span class="chineselangcomma">，</span><a href="http://xn--4gqqsn78jdnl3la.edu.cn/" target="_blank" rel="noopener">一般仅通过.edu.cn</a> 的邮箱就可以完成申请<span class="chineselangcomma">，</span>然后再通过 Dream Spark 申请 Github <span class="chineselangstop">。</span></p><p>同时安利一下 Dream Spark <span class="chineselangcomma">，</span>价值数千元的 Xamarin 免费送<span class="chineselangcomma">，</span>简直业界良心！</p></blockquote><blockquote><p>我就是用github 的学生套餐<span class="chineselangcomma">，</span>入了digitalocean的坑</p><p>这个是我的分享给你的链接<span class="chineselangcomma">，</span><a href="https://link.zhihu.com/?target=https%3A//m.do.co/c/29cad176e9ad">DigitalOcean: Cloud Computing, Simplicity at Scale</a></p><p>注册会送10刀（我也会有10刀）<span class="chineselangcomma">，</span>告诉客服你的github优惠券号码<span class="chineselangcomma">，</span>然后这样你就会得到50刀的优惠<span class="chineselangcomma">，</span>加上你注册的时候的5刀的验证<span class="chineselangcomma">，</span>你账户总共有65刀<span class="chineselangcomma">，</span>这样的话你可以免费用一年的5刀的vps<span class="chineselangstop">。</span></p><p>用5美元一个月的服务器<span class="chineselangcomma">，</span>自己搭建一个VPN 来玩玩<span class="chineselangcomma">，</span>速度非常快<span class="chineselangcomma">，</span>上tumblr喝汤的时候<span class="chineselangcomma">，</span>最高能6M每秒<span class="chineselangcomma">，</span>这是我用技术优化的结果<span class="chineselangcomma">，</span>如果不优化的平均100kb每秒<span class="chineselangstop">。</span>（具体怎么优化<span class="chineselangcomma">，</span>自己google）<span class="chineselangcomma">，</span>秒开youtube.</p></blockquote><blockquote><p>AWS 作为 IaaS 平台,有很多很有意思的服务,如,被炒冷饭的微服务(Microservices)的儿子无服务(Serverless).<br>50 刀可以学习基于 AWS 的基础服务架构,去了解这些基础架构技术,对自己的技术视野有很高的提高.</p></blockquote><h3 id="AWS学生包（不需要国际信用卡！）">AWS学生包（不需要国际信用卡！）</h3><ul><li><p><strong>us-east-1是AWS学生版账号唯一能选择的区域</strong>,由于距离遥远,网络通过层层转发,可能并不是很好</p></li><li><p>学生包使用的是IAM的非管理员授权账户<span class="chineselangcomma">，</span>你连自己的billing都不能查看！只能看着钱一点点减少……</p></li><li><p>学生包的账户似乎不能享受AWS的头一年免费政策！！！！😠</p></li><li><p>EBS必须比快照大小大<span class="chineselangcomma">，</span>所以最小8G<span class="chineselangcomma">，</span>EBS在扣钱就在😠 弹性IP啥的也不是免费的！！</p></li><li><p>流入AWS的流量完全是免费的<span class="chineselangcomma">，</span>但每月的免费流出流量只有15G<span class="chineselangcomma">，</span>超出部分就要收费了<span class="chineselangstop">。</span><br><br></p></li></ul><h3 id="申请免费域名"><a href="https://my.freenom.com" target="_blank" rel="noopener">申请免费域名</a></h3><blockquote><p>freenom 提供了tk<span class="chineselangpause">、</span>ml<span class="chineselangpause">、</span>ga<span class="chineselangpause">、</span>cf<span class="chineselangpause">、</span>gq 这几类后缀的免费域名<span class="chineselangstop">。</span>tk域名<span class="chineselangcomma">，</span>意为 Talker（说话的人）<span class="chineselangstop">。</span>.tk域名是南太平洋岛国托克劳的顶级域名, .ml 是非洲国家马里的后缀, .ga 域名为加蓬国家顶级域名后缀, .cf 是中非共和国的后缀, .gq域名是赤道几内亚国家地区顶级域名<span class="chineselangstop">。</span></p></blockquote><blockquote><p>进入<code>Nameservers</code>页面<span class="chineselangcomma">，</span>更改DNS解析到国内的<a href="https://www.dnspod.cn/" target="_blank" rel="noopener">DNSPod</a>（提速）</p><p>在DNSPod中添加刚刚注册的域名(不用填www)</p><p><a href="https://console.dnspod.cn/dns/yukkuri.tk/set" target="_blank" rel="noopener">https://console.dnspod.cn/dns/yukkuri.tk/set</a></p><p>之后回到Freenom<span class="chineselangcomma">，</span>在Nameservers中填写DNSPod的两个DNS地址 <code>f1g1ns1.dnspod.net</code><span class="chineselangpause">、</span> <code>f1g1ns2.dnspod.net</code></p><ul><li><p>A</p><p>A 记录是最常用类型<span class="chineselangcomma">，</span>将域名指向一个 IPv4 地址<span class="chineselangcomma">，</span>如 8.8.8.8</p></li><li><p>CNAME</p><p>将域名指向另一个域名地址<span class="chineselangcomma">，</span>与其保持相同解析<span class="chineselangcomma">，</span>如 <a href="https://www.dnspod.cn" target="_blank" rel="noopener">https://www.dnspod.cn</a></p></li></ul></blockquote><h2 id="VPS配置">VPS配置</h2><p>使用的是Ubuntu 18.4 tls</p><h3 id="Ubuntu基础">Ubuntu基础</h3><h4 id="用ssh连接到Ubuntu">用ssh连接到Ubuntu</h4><p>使用的软件是xshell<span class="chineselangpause">、</span>xftp**（注意xftp不能登录root账户<span class="chineselangcomma">，</span>记得开放相应权限）**个人版<span class="chineselangstop">。</span>通过亚马逊的public key / user key <code>.pem</code>登录</p><p>附：文件夹权限的开放方法</p><blockquote><p>修改文件夹的属性 改为777 这个是所有用户都可以使用<br>777这个属性 将当前目录下的所有文件及子目录的文件拥有者权限设置为读<span class="chineselangpause">、</span>写<span class="chineselangpause">、</span>可执行<span class="chineselangcomma">，</span>文件拥有者所在的用户组成员具备读<span class="chineselangpause">、</span>写<span class="chineselangpause">、</span>可执行权限<span class="chineselangcomma">，</span>其它用户也具备读<span class="chineselangpause">、</span>写<span class="chineselangpause">、</span>可执行权限</p><p>命令： <code>chmod 777 filename</code> （root权限下）</p><p>这样这个文件夹会高亮 这个时候在这个文件夹里传输数据了</p><p>2.把文件夹权限赋予给某个账户</p><p>如：<code>chown -R user_1 home</code></p><p>就是把 home文件夹的权限给了 user_1 这样就可以传递数据了 不过不能保证这个user_1 用户对home目录的权限</p></blockquote><h4 id="Ubuntu系统服务器获取root权限">Ubuntu系统服务器获取root权限</h4><p>ubuntu的默认账户ubuntu和root账户不需要创建</p><p>新机子应该先设root密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure><p>再</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line"><span class="comment">#接着输入设置的密码就行</span></span><br></pre></td></tr></table></figure><h4 id="更改Ubuntu服务器时间">更改Ubuntu服务器时间</h4><blockquote><p><strong>校验时间</strong></p><p>对于 V2Ray<span class="chineselangcomma">，</span>它的验证方式包含时间<span class="chineselangcomma">，</span>就算是配置没有任何问题<span class="chineselangcomma">，</span>如果时间不正确<span class="chineselangcomma">，</span>也无法连接 V2Ray 服务器的<span class="chineselangcomma">，</span>服务器会认为你这是不合法的请求<span class="chineselangstop">。</span>所以系统时间一定要正确<span class="chineselangcomma">，</span>只要保证时间误差在<strong>一分钟</strong>之内就没问题<span class="chineselangstop">。</span></p><p>对于 VPS(Linux) 可以执行命令 <code>date -R</code> 查看时间：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ date -RSun, 01 Jul 2018 21:57:05 -0400</span><br></pre></td></tr></table></figure><p>输出结果中的 -0400 代表的是时区为西4区<span class="chineselangcomma">，</span>如果转换成东 8 区(+0800)时间则为 <code>2018-07-2 09:57:05</code><span class="chineselangstop">。</span></p><p>如果时间不准确<span class="chineselangcomma">，</span>可以使用 <code>date --set</code> 修改时间<span class="chineselangcomma">，</span>或者使用ntpdate与ntp服务器同步<span class="chineselangstop">。</span></p></blockquote><h4 id="ubuntu-vi编辑器">ubuntu vi编辑器</h4><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/systemd/system/caddy.service <span class="comment">#sudo即以管理员权限执行一些任务&lt;span class='chineselangcomma'&gt;，&lt;/span&gt;vi是自带编辑器</span></span><br></pre></td></tr></table></figure><p>按<kbd>i</kbd>进入insert编辑模式</p><p>按<kbd>esc</kbd>退出编辑模式</p><ul><li><kbd>:wq</kbd>保存后离开</li><li><kbd>:qa</kbd>放弃所有编辑内容离开</li><li>加<kbd>!</kbd>后缀表示强制执行</li></ul><h4 id="ubuntu-删除-span-class-chineselangpause-、-span-新建……">ubuntu 删除<span class="chineselangpause">、</span>新建……</h4><p>百度</p><h3 id="v2ray及caddy安装">v2ray及caddy安装</h3><p>v2ray: <sup>参考：<a href="https://www.rultr.com/tutorials/proxy/2268.html" target="_blank" rel="noopener">https://www.rultr.com/tutorials/proxy/2268.html</a></sup></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s https://install.direct/go.sh)</span><br></pre></td></tr></table></figure><p>这个安装脚本会自动安装v2ray需要的一些东西<span class="chineselangcomma">，</span>某些东西的安装需要root权限<span class="chineselangcomma">，</span>注意</p><blockquote><p>这个脚本会配置自动运行脚本<span class="chineselangstop">。</span>自动运行脚本会在系统重启之后<span class="chineselangcomma">，</span>自动运行 V2Ray<span class="chineselangstop">。</span>目前自动运行脚本只支持带有 Systemd 的系统<span class="chineselangcomma">，</span>以及 Debian / Ubuntu 全系列<span class="chineselangstop">。</span></p></blockquote><p>如果提示 curl: command not found <span class="chineselangcomma">，</span>那是因为你的 VPS 没装 Curl</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update -y &amp;&amp; apt-get install curl -y <span class="comment">#即可</span></span><br></pre></td></tr></table></figure><p>另外网上有人写了v2ray的操作脚本<span class="chineselangcomma">，</span>可以在命令行通过v2ray info之类的命令直接进行操作<span class="chineselangstop">。</span>我没用<span class="chineselangstop">。</span></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl start v2ray</span><br><span class="line">systemctl stop v2ray</span><br><span class="line">systemctl restart v2ray</span><br><span class="line">systemctl status v2ray</span><br><span class="line"><span class="comment">#卸载</span></span><br><span class="line">./go.sh --remove</span><br></pre></td></tr></table></figure><p><br><br></p><p>caddy: <sup>参考：<a href="https://segmentfault.com/a/1190000018242765" target="_blank" rel="noopener">https://segmentfault.com/a/1190000018242765</a></sup></p><p><strong>注意<span class="chineselangcomma">，</span>这里是通过新建一用户名为caddy的用户来进行管理<span class="chineselangcomma">，</span>需要更改caddy.service文件的相应内容</strong><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://getcaddy.com | bash -s personal</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看安装位置</span></span><br><span class="line"><span class="built_in">which</span> caddy</span><br><span class="line"><span class="comment">#输出 /usr/local/bin/caddy</span></span><br><span class="line"><span class="comment">#出于安全考虑&lt;span class='chineselangcomma'&gt;，&lt;/span&gt;切勿以root身份运行Caddy二进制文件&lt;span class='chineselangstop'&gt;。&lt;/span&gt; 为了让Caddy能够以非root用户身份绑定到特权端口（例如80,443）&lt;span class='chineselangcomma'&gt;，&lt;/span&gt;您需要运行setcap命令&lt;span class='chineselangcomma'&gt;，&lt;/span&gt;如下所示</span></span><br><span class="line">sudo <span class="built_in">setcap</span> <span class="string">'cap_net_bind_service=+ep'</span> /usr/<span class="built_in">local</span>/bin/caddy <span class="comment">#与输出相符的地址</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#为Caddy创建一个专用的系统用户：caddy和一组同名的用户：</span></span><br><span class="line">sudo useradd -r -d /var/www -M -s /sbin/nologin caddy</span><br><span class="line"><span class="comment">#注意：此处创建的用户caddy只能用于管理Caddy服务&lt;span class='chineselangcomma'&gt;，&lt;/span&gt;不能用于登录&lt;span class='chineselangstop'&gt;。&lt;/span&gt;</span></span><br><span class="line"><span class="comment">#为Caddy Web服务器创建主目录/ var / www&lt;span class='chineselangcomma'&gt;，&lt;/span&gt;为您的站点创建主目录/var/www/example.com：</span></span><br><span class="line">sudo mkdir -p /var/www/example.com</span><br><span class="line">sudo chown -R caddy:caddy /var/www</span><br><span class="line"><span class="comment">#创建存储SSL证书的目录：</span></span><br><span class="line">sudo mkdir /etc/ssl/caddy</span><br><span class="line">sudo chown -R caddy:root /etc/ssl/caddy</span><br><span class="line">sudo chmod 0770 /etc/ssl/caddy</span><br><span class="line"><span class="comment">#创建一个专用目录来存储Caddy配置文件Caddyfile：</span></span><br><span class="line">sudo mkdir /etc/caddy</span><br><span class="line">sudo chown -R root:caddy /etc/caddy</span><br></pre></td></tr></table></figure><h3 id="新建-span-class-chineselangpause-、-span-修改V2ray-Caddy的配置文件">新建<span class="chineselangpause">、</span>修改V2ray | Caddy的配置文件</h3><p><a href="https://caddyserver.com/v1/tutorial/caddyfile" target="_blank" rel="noopener">官方对如何书写Caddyfile文件的介绍</a></p><p><a href="https://www.gitmemory.com/issue/ToutyRater/v2ray-guide/63/519485234" target="_blank" rel="noopener"><strong>WebSocket+TLS+caddy方案客户端一直报错</strong></a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建名为Caddyfile的Caddy配置文件：</span></span><br><span class="line">sudo touch /etc/caddy/Caddyfile</span><br><span class="line">sudo chown caddy:caddy /etc/caddy/Caddyfile</span><br><span class="line">sudo chmod 444 /etc/caddy/Caddyfile</span><br><span class="line"><span class="comment"># tee命令用于将数据重定向到文件&lt;span class='chineselangcomma'&gt;，&lt;/span&gt;另一方面还可以提供一份重定向数据的副本作为后续命令的stdin&lt;span class='chineselangstop'&gt;。&lt;/span&gt;简单的说就是把数据重定向到给定文件和屏幕上&lt;span class='chineselangstop'&gt;。&lt;/span&gt;</span></span><br><span class="line">cat &lt;&lt;EOF | sudo tee -a /etc/caddy/Caddyfile</span><br><span class="line">yukkuri.tk</span><br><span class="line">&#123;</span><br><span class="line">  root /var/www/yukkuri.tk/ <span class="comment">#服务器展示根目录的index.html文件</span></span><br><span class="line">  gzip</span><br><span class="line">  <span class="built_in">log</span> /var/<span class="built_in">log</span>/caddy/caddy.log</span><br><span class="line">  tls lost@edfus.xyz</span><br><span class="line">  proxy /yukkuridoujinshi localhost:1234 &#123; </span><br><span class="line">    websocket</span><br><span class="line">    header_upstream -Origin</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /var/www/yukkuri.tk</span><br><span class="line">sudo chown -R caddy:caddy /var/www</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;h1&gt;Hello World!&lt;/h1&gt;'</span> | sudo tee /var/www/yukkuri.tk/index.html <span class="comment">#也可以自定义网页内容</span></span><br></pre></td></tr></table></figure><p>建议在电脑这边编辑好caddy.service<span class="chineselangcomma">，</span>再用xftp复制到对应目录**（以下的都是）**</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir &#x2F;etc&#x2F;systemd&#x2F;system</span><br></pre></td></tr></table></figure><p>内容如下：（相对官方文件只更改了User和Group的名称）</p><pre style="height:200px;overflow:auto;white-space:pre-wrap">
[Unit]
Description=Caddy HTTP/2 web server
Documentation=https://caddyserver.com/docs
After=network-online.target
Wants=network-online.target systemd-networkd-wait-online.service
; Do not allow the process to be restarted in a tight loop. If the
; process fails to start, something critical needs to be fixed.
StartLimitIntervalSec=14400
StartLimitBurst=10
[Service]
Restart=on-abnormal
; User and group the process will run as.
User=caddy
Group=caddy
; Letsencrypt-issued certificates will be written to this directory.
Environment=CADDYPATH=/etc/ssl/caddy
; Always set "-root" to something safe in case it gets forgotten in the Caddyfile.
ExecStart=/usr/local/bin/caddy -log stdout -log-timestamps=false -agree=true -conf=/etc/caddy/Caddyfile -root=/var/tmp
ExecReload=/bin/kill -USR1 $MAINPID
; Use graceful shutdown with a reasonable timeout
KillMode=mixed
KillSignal=SIGQUIT
TimeoutStopSec=5s
; Limit the number of file descriptors; see `man systemd.exec` for more limit settings.
LimitNOFILE=1048576
; Unmodified caddy is not expected to use more than that.
LimitNPROC=512
; Use private /tmp and /var/tmp, which are discarded after caddy stops.
PrivateTmp=true
; Use a minimal /dev (May bring additional security if switched to 'true', but it may not work on Raspberry Pi's or other devices, so it has been disabled in this dist.)
PrivateDevices=false
; Hide /home, /root, and /run/user. Nobody will steal your SSH-keys.
ProtectHome=true
; Make /usr, /boot, /etc and possibly some more folders read-only.
ProtectSystem=full
; … except /etc/ssl/caddy, because we want Letsencrypt-certificates there.
;   This merely retains r/w access rights, it does not add any new. Must still be writable on the host!
ReadWritePaths=/etc/ssl/caddy
ReadWriteDirectories=/etc/ssl/caddy
; The following additional security directives only work with systemd v229 or later.
; They further restrict privileges that can be gained by caddy. Uncomment if you like.
; Note that you may have to add capabilities required by any plugins in use.
;CapabilityBoundingSet=CAP_NET_BIND_SERVICE
;AmbientCapabilities=CAP_NET_BIND_SERVICE
;NoNewPrivileges=true
[Install]
WantedBy=multi-user.target</pre><p><strong>开机启动</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl start caddy.service</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> caddy.service</span><br></pre></td></tr></table></figure><h3 id="设置V2ray-config-json">设置V2ray/config.json</h3><blockquote><p><strong>这里需要注意的是<span class="chineselangcomma">，</span>JSON是不支持注释的<span class="chineselangcomma">，</span>所以如果需要复制配置文件<span class="chineselangcomma">，</span>请务必删除<code>//</code>注释<span class="chineselangcomma">，</span>以免造成配置文件错误<span class="chineselangstop">。</span>另外json }前不能加,且注意<span class="chineselangstop">。</span></strong></p></blockquote><ol start="2"><li><p>配置文件时的安全性</p><blockquote><p>另外<span class="chineselangcomma">，</span>最好不要用<code>/ray</code>做websocket路径<span class="chineselangcomma">，</span>换个复杂点<span class="chineselangpause">、</span>随机点的<span class="chineselangstop">。</span>要为某墙的主动检测做防范<span class="chineselangstop">。</span>(SS的默认端口TCP/8388便是一个前车之鉴)</p></blockquote><p>所以我path的名称用的是<code>/yukkuridoujinshi</code>XD 服务器端配置的端口的话因为是web用https的443来伪装<span class="chineselangcomma">，</span>所以不用管</p></li><li><p>服务端及客户端config.json配置</p></li></ol><blockquote><p>服务端V2Ray的配置中关于数据流向分为<code>inbound</code>和<code>outbound</code>两个部分<span class="chineselangstop">。</span>字面意思也很好理解<span class="chineselangcomma">，</span><code>inbound</code>是入流量<span class="chineselangcomma">，</span><code>outbound</code>是出流量</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"outbound"</span>: &#123;</span><br><span class="line">    <span class="attr">"streamSettings"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"tag"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">    <span class="attr">"mux"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"settings"</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"log"</span>: &#123;</span><br><span class="line">    <span class="attr">"access"</span>: <span class="string">"/var/log/v2ray/access.log"</span>,</span><br><span class="line">    <span class="attr">"loglevel"</span>: <span class="string">"info"</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"/var/log/v2ray/error.log"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"outboundDetour"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"blocked"</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"blackhole"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"inbound"</span>: &#123;</span><br><span class="line">    <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">      <span class="attr">"network"</span>: <span class="string">"ws"</span>,</span><br><span class="line">      <span class="attr">"kcpSettings"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"wsSettings"</span>: &#123;</span><br><span class="line">        <span class="attr">"path"</span>: <span class="string">"/yukkuridoujinshi"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"tcpSettings"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"tlsSettings"</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">"security"</span>: <span class="string">""</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"settings"</span>: &#123;</span><br><span class="line">      <span class="attr">"ip"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"udp"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"clients"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"alterId"</span>: <span class="number">104</span>,</span><br><span class="line">          <span class="attr">"security"</span>: <span class="string">"aes-128-gcm"</span>,</span><br><span class="line">          <span class="attr">"id"</span>: <span class="string">"f1412d7b-d064-410e-bfdc-790d314a9587"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"auth"</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">    <span class="attr">"port"</span>: <span class="number">1234</span>,</span><br><span class="line">    <span class="attr">"listen"</span>: <span class="string">"127.0.0.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"inboundDetour"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"routing"</span>: &#123;</span><br><span class="line">    <span class="attr">"settings"</span>: &#123;</span><br><span class="line">      <span class="attr">"rules"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"ip"</span>: [</span><br><span class="line">            <span class="string">"0.0.0.0/8"</span>,</span><br><span class="line">            <span class="string">"10.0.0.0/8"</span>,</span><br><span class="line">            <span class="string">"100.64.0.0/10"</span>,</span><br><span class="line">            <span class="string">"127.0.0.0/8"</span>,</span><br><span class="line">            <span class="string">"169.254.0.0/16"</span>,</span><br><span class="line">            <span class="string">"172.16.0.0/12"</span>,</span><br><span class="line">            <span class="string">"192.0.0.0/24"</span>,</span><br><span class="line">            <span class="string">"192.0.2.0/24"</span>,</span><br><span class="line">            <span class="string">"192.168.0.0/16"</span>,</span><br><span class="line">            <span class="string">"198.18.0.0/15"</span>,</span><br><span class="line">            <span class="string">"198.51.100.0/24"</span>,</span><br><span class="line">            <span class="string">"203.0.113.0/24"</span>,</span><br><span class="line">            <span class="string">"::1/128"</span>,</span><br><span class="line">            <span class="string">"fc00::/7"</span>,</span><br><span class="line">            <span class="string">"fe80::/10"</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"domain"</span>: <span class="literal">null</span>,</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">          <span class="attr">"port"</span>: <span class="literal">null</span>,</span><br><span class="line">          <span class="attr">"outboundTag"</span>: <span class="string">"blocked"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"domainStrategy"</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"strategy"</span>: <span class="string">"rules"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dns"</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 <code>port</code> 是V2Ray程序侦听的端口号<span class="chineselangcomma">，</span>注意和<strong>Candyfile里的保持一致</strong>；<code>protocol</code>是指入流量数据使用的加密协议<span class="chineselangcomma">，</span>默认是V2Ray项目自行开发的 vmess 协议<span class="chineselangcomma">，</span>一般不做修改；<code>id</code>是用来区分不同V2Ray软件的识别码<span class="chineselangcomma">，</span>只有<code>id</code>完全一致时<span class="chineselangcomma">，</span>才可以让两个V2Ray软件协同工作<span class="chineselangcomma">，</span>类似于加密密钥<span class="chineselangcomma">，</span>格式特殊(<code>UUID</code>)一般通过软件生成<span class="chineselangstop">。</span>**（安装v2ray的时候会生成一个<code>port</code>号和<code>UUID</code>自动填写在<code>config.json</code>里<span class="chineselangcomma">，</span>使不使用生成的随意就好）**另外<code>alterId</code>的值也可以随便填（默认64<span class="chineselangcomma">，</span>不清楚范围<span class="chineselangcomma">，</span>64~233内都是可以的<span class="chineselangcomma">，</span>注意和客户端保持一致</p><p>注意<code>Network</code> = <code>ws</code> (WebSocket)以及wsSetting里的<code>path</code>设定<span class="chineselangstop">。</span>这里的<code>path</code>需要和<code>Caddyfile</code>里的以及客户端的一致</p><p>VPS作为代理服务器的话<span class="chineselangcomma">，</span>V2Ray的<code>outbound</code>部分一般不需要修改<span class="chineselangcomma">，</span>其默认配置也没什么实际内容</p><p>同时<span class="chineselangcomma">，</span>V2Ray也支持Shadowsocks协议<span class="chineselangcomma">，</span>把V2Ray软件当做Shadowsocks服务器来使用<span class="chineselangstop">。</span>完成此功能<span class="chineselangcomma">，</span>需要在配置文件中增加<code>inboundDetour</code>配置块<span class="chineselangcomma">，</span>使其支持另一种入流量</p></blockquote><p>V2ray的配置文件模板：<a href="https://github.com/KiriKira/vTemplate" target="_blank" rel="noopener">https://github.com/KiriKira/vTemplate</a></p><h3 id="v2ray-config-json-span-class-chineselangpause-、-span-caddyfile配置文件检测">v2ray/config.json<span class="chineselangpause">、</span>caddyfile配置文件检测</h3><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;/usr/bin/v2ray/v2ray -<span class="built_in">test</span> -config /etc/v2ray/config.json</span><br></pre></td></tr></table></figure></blockquote><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">caddy -agree -conf /etc/caddy/Caddyfile</span><br></pre></td></tr></table></figure><p><strong>注意！可能会出现以下log</strong></p><blockquote><p>Caddy wouldn’t be registering new ACME accounts unless it was started from a fresh slate every time.</p><hr><p><strong>too many failed authorizations recently</strong></p><p><strong><a href="https://community.letsencrypt.org/t/error-429-too-many-registrations-for-this-ip/83204" target="_blank" rel="noopener">Error 429 too many registrations for this IP</a></strong></p><blockquote><p>2020/01/11 04:53:56 [INFO] [<a href="http://yukkuri.tk" target="_blank" rel="noopener">yukkuri.tk</a>] acme: Could not find solver for: tls-alpn-01<br>2020/01/11 04:53:56 [INFO] [<a href="http://yukkuri.tk" target="_blank" rel="noopener">yukkuri.tk</a>] acme: use http-01 solver<br>2020/01/11 04:53:56 [INFO] [<a href="http://yukkuri.tk" target="_blank" rel="noopener">yukkuri.tk</a>] acme: Trying to solve HTTP-01<br>2020/01/11 04:54:00 [INFO] Deactivating auth: <a href="https://acme-v02.api.letsencrypt.org/acme/authz-v3/2220024879" target="_blank" rel="noopener">https://acme-v02.api.letsencrypt.org/acme/authz-v3/2220024879</a><br>2020/01/11 04:54:00 [INFO] U...</p></blockquote></blockquote><p><strong>等一会儿（我也不知道多久）就好了（我也不知道为什么）</strong></p></blockquote><h2 id="客户端V2ray的配置">客户端V2ray的配置</h2><p>客户端的话<span class="chineselangcomma">，</span><code>inbound</code>配置侦听本机<span class="chineselangcomma">，</span>而<code>outbound</code>则用来配置连接访问的服务器</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"outbound"</span>: &#123;</span><br><span class="line"> <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">   <span class="attr">"network"</span>: <span class="string">"ws"</span>,</span><br><span class="line">   <span class="attr">"kcpSettings"</span>: <span class="literal">null</span>,</span><br><span class="line">   <span class="attr">"wsSettings"</span>: &#123;</span><br><span class="line">     <span class="attr">"path"</span>: <span class="string">"/yukkuridoujinshi"</span>	<span class="comment">//你的path</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"tcpSettings"</span>: <span class="literal">null</span>,</span><br><span class="line">   <span class="attr">"tlsSettings"</span>: &#123;&#125;,</span><br><span class="line">   <span class="attr">"security"</span>: <span class="string">"tls"</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">"tag"</span>: <span class="string">"agentout"</span>,</span><br><span class="line"> <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line"> <span class="attr">"mux"</span>: &#123;</span><br><span class="line">   <span class="attr">"enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">"concurrency"</span>: <span class="number">8</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">"settings"</span>: &#123;</span><br><span class="line">   <span class="attr">"vnext"</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">"users"</span>: [</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">"alterId"</span>: <span class="number">104</span>,	<span class="comment">//服务端的</span></span><br><span class="line">           <span class="attr">"security"</span>: <span class="string">"aes-128-gcm"</span>,</span><br><span class="line">           <span class="attr">"id"</span>: <span class="string">"f1412d7b-d064-410e-bfdc-790d314a9587"</span> <span class="comment">//服务端的</span></span><br><span class="line">         &#125;</span><br><span class="line">       ],</span><br><span class="line">       <span class="attr">"port"</span>: <span class="number">443</span>,	<span class="comment">//不能改</span></span><br><span class="line">       <span class="attr">"address"</span>: <span class="string">"yukkuri.tk"</span>	<span class="comment">//你的域名</span></span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line"> &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"log"</span>: &#123;</span><br><span class="line"> <span class="attr">"access"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="attr">"loglevel"</span>: <span class="string">"info"</span>,</span><br><span class="line"> <span class="attr">"error"</span>: <span class="string">""</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"outboundDetour"</span>: [</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="attr">"tag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">   <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">   <span class="attr">"settings"</span>: &#123;</span><br><span class="line">     <span class="attr">"response"</span>: <span class="literal">null</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="attr">"tag"</span>: <span class="string">"blockout"</span>,</span><br><span class="line">   <span class="attr">"protocol"</span>: <span class="string">"blackhole"</span>,</span><br><span class="line">   <span class="attr">"settings"</span>: &#123;</span><br><span class="line">     <span class="attr">"response"</span>: &#123;</span><br><span class="line">       <span class="attr">"type"</span>: <span class="string">"http"</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">],</span><br><span class="line"><span class="attr">"inbound"</span>: &#123;</span><br><span class="line"> <span class="attr">"streamSettings"</span>: <span class="literal">null</span>,</span><br><span class="line"> <span class="attr">"settings"</span>: &#123;</span><br><span class="line">   <span class="attr">"ip"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">   <span class="attr">"udp"</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">"clients"</span>: <span class="literal">null</span>,</span><br><span class="line">   <span class="attr">"auth"</span>: <span class="string">"noauth"</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">"protocol"</span>: <span class="string">"socks"</span>,</span><br><span class="line"> <span class="attr">"port"</span>: <span class="number">12345</span>,	<span class="comment">//填一个不会被占用的端口&lt;span class='chineselangcomma'&gt;，&lt;/span&gt;默认1080&lt;span class='chineselangstop'&gt;。&lt;/span&gt;用的是图形操作界面的话记得改本地端口</span></span><br><span class="line"> <span class="attr">"listen"</span>: <span class="string">"0.0.0.0"</span> <span class="comment">//监听所有流量</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"inboundDetour"</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">"routing"</span>: &#123;</span><br><span class="line"> <span class="attr">"settings"</span>: &#123;</span><br><span class="line">   <span class="attr">"rules"</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">"ip"</span>: [</span><br><span class="line">         <span class="string">"0.0.0.0/8"</span>,</span><br><span class="line">         <span class="string">"10.0.0.0/8"</span>,</span><br><span class="line">         <span class="string">"100.64.0.0/10"</span>,</span><br><span class="line">         <span class="string">"127.0.0.0/8"</span>,</span><br><span class="line">         <span class="string">"169.254.0.0/16"</span>,</span><br><span class="line">         <span class="string">"172.16.0.0/12"</span>,</span><br><span class="line">         <span class="string">"192.0.0.0/24"</span>,</span><br><span class="line">         <span class="string">"192.0.2.0/24"</span>,</span><br><span class="line">         <span class="string">"192.168.0.0/16"</span>,</span><br><span class="line">         <span class="string">"198.18.0.0/15"</span>,</span><br><span class="line">         <span class="string">"198.51.100.0/24"</span>,</span><br><span class="line">         <span class="string">"203.0.113.0/24"</span>,</span><br><span class="line">         <span class="string">"::1/128"</span>,</span><br><span class="line">         <span class="string">"fc00::/7"</span>,</span><br><span class="line">         <span class="string">"fe80::/10"</span></span><br><span class="line">       ],</span><br><span class="line">       <span class="attr">"domain"</span>: <span class="literal">null</span>,</span><br><span class="line">       <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">       <span class="attr">"port"</span>: <span class="literal">null</span>,</span><br><span class="line">       <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span></span><br><span class="line">     &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="attr">"domainStrategy"</span>: <span class="string">"IPIfNonMatch"</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">"strategy"</span>: <span class="string">"rules"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"dns"</span>: &#123;</span><br><span class="line"> <span class="attr">"servers"</span>: [</span><br><span class="line">   <span class="string">"8.8.8.8"</span>,</span><br><span class="line">   <span class="string">"8.8.4.4"</span>,</span><br><span class="line">   <span class="string">"localhost"</span></span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>再下载V2ray<span class="chineselangcomma">，</span>按需下载V2rayN等<span class="chineselangcomma">，</span>修改相应config.json即可</p><h2 id="VPS系统的其他设定">VPS系统的其他设定</h2><h3 id="开启BBR">开启BBR</h3><blockquote><p><code>bbr</code>这个东西真乃神器<span class="chineselangcomma">，</span>所以如果你的代理服务器在国外<span class="chineselangcomma">，</span>强烈建议开启<code>bbr</code>的功能<span class="chineselangstop">。</span>我的小鸡使用的是<code>debian 9</code><span class="chineselangcomma">，</span>默认内核是支持bbr加速的<span class="chineselangcomma">，</span>但是没有开启<span class="chineselangstop">。</span>如果你的系统过于陈旧<span class="chineselangcomma">，</span>需要更新linux内核至<code>4.9</code>以上并编译安装bbr<span class="chineselangcomma">，</span>具体的安装步骤可以去百度<span class="chineselangcomma">，</span>网上有大把的教程<span class="chineselangstop">。</span></p></blockquote><h4 id="检查Linux内核的版本">检查Linux内核的版本</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure><p>查看内核是否&gt;=4.14.0</p><p>若无则升级内核：</p><blockquote><p>1.获取root权限</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -s</span><br></pre></td></tr></table></figure><p>2.下载最新内核,最新内核看<a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/" target="_blank" rel="noopener">这里</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.14/linux-image-4.14.0-041400-generic_4.14.0-041400.201711122031_amd64.deb</span><br></pre></td></tr></table></figure><p>3.安装内核</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i linux-image-4.14.0-041400-generic_4.14.0-041400.201711122031_amd64.deb</span><br></pre></td></tr></table></figure><p>4.删除旧内核（可选）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep linux-image </span><br><span class="line">apt-get purge 旧内核</span><br></pre></td></tr></table></figure><p>5.更新引导grub系统引导文件并重新启动</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update-grub</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>重启完毕重新链接服务器并获取root权限</p></blockquote><blockquote><p>开启<strong>BBR</strong>需要修改/etc/sysctl.conf<span class="chineselangcomma">，</span>所以<strong>先加权限</strong><span class="chineselangcomma">，</span>执行</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>然后开启<strong>BBR</strong><span class="chineselangcomma">，</span>先执行</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">modprobe tcp_bbr</span><br><span class="line">echo "tcp_bbr" &gt;&gt; /etc/modules-load.d/modules.conf</span><br></pre></td></tr></table></figure><p>然后执行</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo "net.core.default_qdisc=fq" &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo "net.ipv4.tcp_congestion_control=bbr" &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>保存生效</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><p>查看是否生效</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br></pre></td></tr></table></figure><ul><li>返回值一般为：net.ipv4.tcp_available_congestion_control = <strong>bbr</strong> cubic reno</li></ul><p>查看BBR是否启动</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep bbr</span><br></pre></td></tr></table></figure><ul><li>返回值一般为：tcp_<strong>bbr</strong> 20480 0</li></ul><p>如以上查看返回值不一样但都有<strong>BBR</strong><span class="chineselangcomma">，</span>则内核已经成功开启<strong>BBR</strong></p></blockquote><h3 id="VPS上的Ubuntu系统重启（System-Restart-Required）">VPS上的Ubuntu系统重启（System Restart Required）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><blockquote><ol><li>你怎么真的重新启动(我是一个初学者<span class="chineselangcomma">，</span>并使用12.04.1 LTS)？</li><li>我应该在提示时总是重新启动系统吗？</li><li>重新启动系统是否会影响通过SSH进行访问或在执行此操作之前需要考虑的其他注意事项？</li></ol><ul><li><p>是的你应该<span class="chineselangstop">。</span>对于大多数情况<span class="chineselangcomma">，</span>安装Linux内核更新时需要重新启动<span class="chineselangstop">。</span>这些更新通常是安全更新<span class="chineselangcomma">，</span>然后才会在重新启动后生效<span class="chineselangstop">。</span>正常应用程序(如Firefox)的更新在重新启动程序后生效<span class="chineselangstop">。</span> Firefox应该提示你自动执行此操作<span class="chineselangcomma">，</span>但其他程序可能不会<span class="chineselangcomma">，</span>因此需要牢记<span class="chineselangstop">。</span></p></li><li><p>要从命令行重新启动<span class="chineselangcomma">，</span>请运行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo reboot</span><br></pre></td></tr></table></figure></li><li><p>总的来说<span class="chineselangcomma">，</span>重新启动是一项非常安全的操作<span class="chineselangcomma">，</span>我不会认为它在任何方面都不安全<span class="chineselangstop">。</span>当然<span class="chineselangcomma">，</span>当您重新启动计算机时<span class="chineselangcomma">，</span>会丢失RAM中的所有信息<span class="chineselangcomma">，</span>因此请确保在关闭计算机之前保存所有打开的文档和文件<span class="chineselangstop">。</span>当你重新启动时<span class="chineselangcomma">，</span>你的电脑当然会脱机几分钟<span class="chineselangstop">。</span>如果你正在运行一台服务器<span class="chineselangcomma">，</span>它将会停机几分钟<span class="chineselangstop">。</span>如果你有一个开放的SSH会话<span class="chineselangcomma">，</span>它将被终止<span class="chineselangstop">。</span></p></li><li><p>重启后没有任何东西会影响ssh连接<span class="chineselangstop">。</span></p></li></ul></blockquote><h3 id="开机自动执行">开机自动执行</h3><blockquote><p>rc.local脚本是一个Ubuntu开机后会自动执行的脚本<span class="chineselangcomma">，</span>在该脚本内添加命令行<span class="chineselangcomma">，</span>开机时会自动执行<span class="chineselangstop">。</span></p><p>脚本路径/etc/rc.local</p><p>需要root权限才能修改<span class="chineselangstop">。</span></p><p>添加命令<br>打开文件<span class="chineselangcomma">，</span>在exit 0前添加要执行的命令<span class="chineselangcomma">，</span>里面可以直接写命令或者执行Shell脚本文件sh<span class="chineselangstop">。</span></p><p>如下<span class="chineselangcomma">，</span>添加的5行命令</p><p>第1,2行是用于输出log 的<br>第4,5行<span class="chineselangcomma">，</span>是启动程序的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/sh -e</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># rc.local</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This script is executed at the end of each multiuser runlevel.</span></span><br><span class="line"><span class="comment"># Make sure that the script will "exit 0" on success or any other</span></span><br><span class="line"><span class="comment"># value on error.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In order to enable or disable this script just change the execution</span></span><br><span class="line"><span class="comment"># bits.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default this script does nothing.:</span></span><br><span class="line">/bin/bash /usr/<span class="built_in">local</span>/XX-Net-3.10.4/xx_net.sh 1&gt;&gt; /etc/mylog   <span class="comment"># send stderr from rc.local to a log file </span></span><br><span class="line">2&gt;&amp;1   <span class="comment"># send stdout to the same log file </span></span><br><span class="line"><span class="built_in">set</span> -x    <span class="comment"># tell sh to display commands before execution </span></span><br><span class="line">sudo miredo</span><br><span class="line">sudo /usr/<span class="built_in">local</span>/XX-Net-3.10.4/xx_net.sh start</span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>这里的设置开机自动执行的sudo命令也是可以执行的</p></blockquote><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>注意因为是新建了caddy用户进行操作<span class="chineselangcomma">，</span>所以对caddy.service有相应更改 <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section></div><footer class="article-footer"><a data-url="https://edfus.github.io/2020/01/v2ray-aws/" data-id="ckbf15il7001wpsvf0fkn2ch6" data-clipboard-text="用aws来玩玩V2ray
https://edfus.xyz/2020/01/v2ray-aws/" class="article-share-link">Share</a><div class="article-share-success">Share link copied</div><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/categories/tech/VPN/" rel="tag">VPN</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/categories/tech/aws/" rel="tag">aws</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/categories/tech/总结/" rel="tag">总结</a></li></ul></footer></div><nav id="article-nav"><h3>相关文章：</h3><ul class="related-posts outer"><li><a href="/2019/12/flash-wei-shi-me-hui-bei-tao-tai/" class="article-more-link">Flash为何会被淘汰？</a><a href="/categories/tech/Flash/" class="article-more-tag-link" rel="tag">Flash</a><a href="/categories/tech/总结/" class="article-more-tag-link" rel="tag">总结</a></li><li><a href="/2019/12/chong-zhuang-xi-tong-kuai-su-bu-shu-gong-zuo-huan-jing/" class="article-more-link">win10快速部署与优化</a><a href="/categories/tech/总结/" class="article-more-tag-link" rel="tag">总结</a><a href="/categories/tech/Win10/" class="article-more-tag-link" rel="tag">Win10</a><a href="/categories/tech/优化/" class="article-more-tag-link" rel="tag">优化</a></li></ul></nav></article><section id="gitalk"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/edfus/storage/gitalk/gitalk.css"><script src="https://cdn.jsdelivr.net/gh/edfus/storage/gitalk/gitalk.min.js"></script><div id="gitalk-container"></div><script>var gitalk=new Gitalk({clientID:"e416342d498f5b12cc5c",clientSecret:"cc13255dddbbb4b3acaa93750e10d8e48d935b19",repo:"edfus.github.io",owner:"edfus",admin:["edfus"],id:"179d8435cb978943381bbf50f451e41c",distractionFreeMode:!1,createIssueManually:!0,title:"用aws来玩玩V2ray",body:"category: tech<br>https://edfus.xyz/2020/01/v2ray-aws/",pagerDirection:"first"});gitalk.render("gitalk-container")</script></section></section></div><footer id="footer"><div id="footer-info">&copy; 2020 edfus<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br><span class="post-count">站点总字数：38万+</span><br>♪ <span id="footer-song-name"><span class="delay0" style="animation:none 3.6s linear infinite;animation-delay:0ms">最</span><span class="delay1" style="animation:none 3.6s linear infinite;animation-delay:.4s">も</span><span class="delay2" style="animation:none 3.6s linear infinite;animation-delay:.8s">澄</span><span class="delay3" style="animation:none 3.6s linear infinite;animation-delay:1.2s">み</span><span class="delay4" style="animation:none 3.6s linear infinite;animation-delay:1.6s">わ</span><span class="delay5" style="animation:none 3.6s linear infinite;animation-delay:2s">た</span><span class="delay6" style="animation:none 3.6s linear infinite;animation-delay:2.4s">る</span><span class="delay7" style="animation:none 3.6s linear infinite;animation-delay:2.8s">空</span><span class="delay8" style="animation:none 3.6s linear infinite;animation-delay:3.2s">と</span><span class="delay9" style="animation:none 3.6s linear infinite;animation-delay:3.6s">海</span></span></div></footer><style>#footer a{color:#2ab8ff;background-color:rgba(0,0,0,.05);text-decoration:none;outline:0;-webkit-transition:all .2s ease-in-out;-moz-transition:all .2s ease-in-out;-ms-transition:all .2s ease-in-out;transition:all .2s ease-in-out}#footer a:hover{color:#00ffce}#footer{background:linear-gradient(black,transparent),url(https://cdn.jsdelivr.net/gh/edfus/storage/images/footer-reimu.png),#121621;border-top:1px solid #fff;color:#fff;margin:20px auto 0;overflow:hidden;width:100%;background-repeat:no-repeat,no-repeat,no-repeat;background-position:0 0,calc(60% + 40px) 40%,0 0;background-size:contain}#footer-info{line-height:1.6em;font-size:.85em;padding:50px 20px;margin:0 auto;width:854px}@media screen and (max-width:479px){#footer{margin:0}#footer-info{padding:20px 0 20px 20px;width:calc(97.5% - 20px)}}</style></div><nav id="mobile-nav"><a href="/" class="mobile-nav-link">Home</a> <a href="/categories/tech/" class="mobile-nav-link">Tech</a> <a href="/about/" class="mobile-nav-link">About</a> <a href="/more/" class="mobile-nav-link">More</a></nav><script src="https://apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script><script>"undefined"==typeof jQuery&&document.write(unescape("%3Cscript src='https://cdn.jsdelivr.net/gh/edfus/storage/js/jquery-2.0.3.min.js' type='text/javascript'%3E%3C/script%3E"))</script><a href="#" class="gotop"><img src="https://cdn.jsdelivr.net/gh/edfus/storage/up.png" alt="go to top"></a><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/edfus/storage/fancybox/jquery.fancybox.css"><script src="https://cdn.jsdelivr.net/gh/edfus/storage/fancybox/jquery.fancybox.pack.js"></script><script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll@15.0.0/dist/smooth-scroll.polyfills.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/gh/edfus/storage/js/script.js"></script></div></body></html>